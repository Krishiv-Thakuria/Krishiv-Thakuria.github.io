class MyCallbacks: public BLECharacteristicCallbacks {
    void onWrite(BLECharacteristic *pCharacteristic) {
      String rxValue = pCharacteristic->getValue().c_str();
      Serial.print("Received Value: ");
      Serial.println(rxValue);

      // Stop all motors first
      digitalWrite(leftWheel, LOW);
      digitalWrite(leftWheelBack, LOW);
      digitalWrite(rightWheel, LOW);
      digitalWrite(rightWheelBack, LOW);

      if (rxValue.length() > 0) {
        if (rxValue[0] == 'F') {
          Serial.println("Moving forward!");
          digitalWrite(leftWheel, HIGH);
          digitalWrite(rightWheel, HIGH);
        } 
        else if (rxValue[0] == 'B') {
          Serial.println("Moving backward!");
          digitalWrite(leftWheelBack, HIGH);
          digitalWrite(rightWheelBack, HIGH);
        }
        else if (rxValue[0] == 'L') {
          Serial.println("Turning left!");
          digitalWrite(rightWheel, HIGH);      // Right wheel forward
          digitalWrite(leftWheelBack, HIGH);   // Left wheel backward
        }
        else if (rxValue[0] == 'R') {
          Serial.println("Turning right!");
          digitalWrite(leftWheel, HIGH);       // Left wheel forward
          digitalWrite(rightWheelBack, HIGH);  // Right wheel backward
        }
        else if (rxValue[0] == 'S') {
          Serial.println("Stopped");
          // Motors already stopped at beginning of onWrite
        }
      }
    }
};
